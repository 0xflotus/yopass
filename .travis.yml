matrix:
  include:
    - language: go
      sudo: false
      go:
        - "1.11.x"
      env:
        - GO111MODULE=on
      install: true

      script:
        - go test ./... -race -coverprofile=coverage.txt -covermode=atomic -v

      after_success:
        - bash <(curl -s https://codecov.io/bash)
    - language: node_js
      node_js:
        - "node"
      before_install:
        - cd website
      before_script:
        - yarn start &
        - while true; do (curl -s --max-time 1 localhost:3000 |grep -qi yopass && break) || echo 'waiting for webserver to start' && sleep 1; done
      env:
        - REACT_APP_BACKEND_URL='https://api.yopass.se'
